require(["jquery","render","storage","getReq","base64","jsonp"],function(e,i,c,t,n,a){var o=e(".artical-con"),s=e(".cur-chapter"),r=t().fiction_id,l=!0,f="#0f1410",g=c.get("bg")||"#f7eee5",u=c.get("chapter_id")||1;function d(){e.ajax({url:"/api/artical",dataType:"json",data:{fiction_id:r,chapter_id:u},success:function(t){console.log(t),a({url:t.jsonp,callback:"duokan_fiction_chapter",cache:!0,success:function(t){var c=e.base64.atob(t,!0),n=JSON.parse(c);console.log(n),i(n,e("#artical"),e(".artical-con"),!0)}})},error:function(t){console.warn(t)}})}s.html(u),c.get("tag")&&"黑夜"!=c.get("tag")&&(l=!1),l?o.css("background",g):o.css("background",f),o.show(),e.ajax({url:"/api/chapter",dataType:"json",data:{fiction_id:r},success:function(t){e(".total-chapter").html(t.item.toc.length)},error:function(t){console.warn(t)}}),d(),e(".pre-btn").on("click",function(){1<u?(u-=1,d(),s.html(u),c.set("chapter_id",u)):alert("没有上一章")}),e(".next-btn").on("click",function(){u<4?(u+=1,d(),s.html(u),c.set("chapter_id",u)):alert("没有下一章")}),o.on("click",function(){e(".set-wrap").show()}),e(".mask").on("click",function(){e(".set-wrap").hide(),e(".set-panel").hide(),e(".size").removeClass("active")}),e(".icon-circle-back").on("click",function(){history.go(-1)}),e(".chapter-btn").on("click",function(){window.location.href="../../page/chapter-list.html?fiction_id="+r+"&chapter_id="+u}),e(".size").on("click",function(){e(".set-panel").toggle(),e(this).toggleClass("active")}),e(".day").on("click",function(){e(this).toggleClass("light"),l?(e(this).find("dd").text("白天"),o.css("background",f)):(e(this).find("dd").text("黑夜"),o.css("background",g));var t=(l=!l)?"黑夜":"白天";c.set("tag",t)});var h=c.get("fz")||14;e(".artical-con p").css("font-size",h/37.5+"rem"),e(".large-btn").on("click",function(){h<28&&(h+=2,c.set("fz",h)),e(".artical-con p").css("font-size",h/37.5+"rem")}),e(".small-btn").on("click",function(){12<h&&(h-=2,c.set("fz",h)),e(".artical-con p").css("font-size",h/37.5+"rem")}),e(".set-bg-btns").on("click","li",function(){e(this).addClass("active").siblings().removeClass("active"),g=e(this).attr("bg-color"),c.set("bg",g),l&&o.css("background",g)})});