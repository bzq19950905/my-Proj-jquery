require(["jquery","swiper","bscroll","render","text!bookTb","text!bookLr","GetSlideDirection","storage"],function(s,i,e,l,t,o,n,a){console.log(t);var r,c,d=new i(".city-swiper",{onSlideChangeStart:function(e){var t=e.activeIndex;1==t?s(".line").addClass("move"):s(".line").removeClass("move"),s("tab-item").eq(t).addClass("active").siblings().removeClass("active")}});document.addEventListener("touchstart",function(e){r=e.touches[0].pageX,c=e.touches[0].pageY},!1),document.addEventListener("touchend",function(e){var t,o;switch(t=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY,n(r,c,t,o)){case 3:d.slideTo(1);break;case 4:d.slideTo(0)}},!1);var u=new e(".city-scroll",{probeType:2,click:!0}),p=s(".city-scroll>div"),h=s("html").css("fontSize"),m=44*parseFloat(h)/37.5;console.log(m);var f,g=1,v="上拉加载",w="下拉刷新",y="释放加载更多",b="释放刷新",x="我是有底线的";u.on("scroll",function(){this.y<this.maxScrollY-m?f<g?p.attr("up",x):p.attr("up",y):this.y<this.maxScrollY-m/2?f<g?p.attr("up",x):p.attr("up",v):this.y>m?p.attr("down",b):this.y>m/2&&this.y<m&&p.attr("down",w)}),u.on("scrollEnd",function(){f<g?p.attr("up",x):p.attr("up",v),p.attr("down",w)}),u.on("touchEnd",function(){if(p.attr("up")===y){if(console.log("上拉加载"),f<g)return!1;e=g,s.ajax({url:"/api/recommend",dataType:"json",data:{pageNum:e,count:10},success:function(e){console.log(e),f=e.total/10,l(e.items,s("#l-r-tpl"),s("#load-more")),u.refresh()},error:function(e){console.warn(e)}}),g++}var e;p.attr("down")===b&&(console.log("下拉刷新"),window.location.reload())}),s(".tab-item").on("click",function(){var e=s(this).index();d.slideTo(e),1==e?s(".line").addClass("move"):s(".line").removeClass("move"),s(this).addClass("active").siblings().removeClass("active")}),s(".switch-shelf").on("click",function(){s(".shelf-list").toggleClass("list-type")}),s(".icon-person").on("click",function(){var e;(e=a.get("username")||"")?s.ajax({url:"/isLogin",dataType:"json",type:"post",data:{username:e},success:function(e){console.log(e),1===e.code&&e.result?window.location.href="../../page/my.html":(1===e.code&&!e.result||2===e.code)&&(location.href="../../page/login.html")},error:function(e){console.warn(e)}}):location.href="../../page/login.html"}),s("body").append(t),s("body").append(o),s.ajax({url:"/api/index",dataType:"json",success:function(e){console.log(e);var t=e.items[0].data,o=e.items[1].data,n=e.items[2].data.data;n[0].isShowNum=!0;var a=[n[0]];l(t,s("#slide-tpl"),s(".banner")),l(o,s("#t-b-tpl"),s("#hot")),l(a,s("#l-r-tpl"),s("#first-item")),l(n.slice(1),s("#recommed-list-tpl"),s("#not-first")),new i(".banner-swiper",{autoplay:3e3,loop:!0})},error:function(e){console.warn(e)}})});